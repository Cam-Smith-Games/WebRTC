{"version":3,"file":"main.js","mappings":"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","sources":["webpack://webrtc-test/./src/peer/client.ts","webpack://webrtc-test/./src/peer/host.ts","webpack://webrtc-test/./src/peer/peer.ts","webpack://webrtc-test/webpack/bootstrap","webpack://webrtc-test/webpack/runtime/define property getters","webpack://webrtc-test/webpack/runtime/hasOwnProperty shorthand","webpack://webrtc-test/webpack/runtime/make namespace object","webpack://webrtc-test/./src/main.ts"],"sourcesContent":["import { Peer } from \"./peer\";\r\n\r\nexport class Client extends Peer {\r\n    \r\n    public async init() {\r\n        const local = this.local;\r\n\r\n        const host:RTCSessionDescription = JSON.parse(window.prompt(\"Paste Host Session\"));\r\n\r\n        var p = this.getCandidates();\r\n\r\n        await local.setRemoteDescription(host);\r\n        const answer = await local.createAnswer();\r\n        await local.setLocalDescription(answer)\r\n\r\n        const candidate_count = await p;\r\n        console.log(`found ${candidate_count} ICE candidates...`);\r\n\r\n\r\n        \r\n\r\n        // receiving a data channel...\r\n        local.ondatachannel = (event) => {\r\n            console.log(\"CLIENT: data channel!\");\r\n            this.channel_init(event.channel);    \r\n        }\r\n\r\n\r\n        const client_json = JSON.stringify(local.localDescription.toJSON());\r\n        //console.log(\"CLIENT: \");\r\n        //console.log(client_json);\r\n        await navigator.clipboard.writeText(client_json);\r\n        this.log(\"copied client desc to clipboard...\");\r\n    }\r\n}","import { Peer } from \"./peer\";\r\n\r\nexport class Host extends Peer {\r\n\r\n    public async init() {\r\n        const local = this.local;\r\n\r\n        // receiving a data channel...\r\n        local.ondatachannel = function (event) {\r\n            console.log(\"HOST: data channel!\");\r\n        }\r\n\r\n        this.channel_init(local.createDataChannel(\"data\"));\r\n        \r\n        // todo: prompt room_id here\r\n\r\n        const offer = await local.createOffer({\r\n            offerToReceiveAudio: true, // these need to be true or else ice states remain \"new\" and you never receive any candidates...\r\n            //offerToReceiveVideo: true\r\n            offerToReceiveVideo: true\r\n        })\r\n        await local.setLocalDescription(offer);\r\n\r\n\r\n        const host_json = JSON.stringify(local.localDescription.toJSON());\r\n\r\n        await navigator.clipboard.writeText(host_json);\r\n        this.log(\"copied host desc to clipboard...\");\r\n\r\n        const json = window.prompt(\"Paste Remote Answer\");\r\n        const remote:RTCSessionDescription = JSON.parse(json);\r\n        console.log(\"remote desc:\", remote);\r\n\r\n        var p = this.getCandidates();\r\n\r\n        await local.setRemoteDescription(remote);\r\n\r\n        const candidate_count = await p;\r\n        console.log(`found ${candidate_count} candidates`);\r\n\r\n        console.log(local);\r\n\r\n\r\n        local.onconnectionstatechange = function(e) {\r\n            console.log(\"connection state change: \", e);\r\n            console.log(\"state: \", local.connectionState);\r\n\r\n            if (local.connectionState == \"connected\") {\r\n            \r\n                console.log(\"CONNECTED...\");\r\n            }\r\n        }\r\n    }\r\n}","export abstract class Peer {\r\n\r\n    protected local:RTCPeerConnection;\r\n    protected channel:RTCDataChannel;\r\n\r\n    constructor(local:RTCPeerConnection) {\r\n        this.local = local;\r\n    }\r\n\r\n    public abstract init():Promise<void>;\r\n\r\n    send(data:string) {\r\n        this.channel.send(data);\r\n    }\r\n\r\n    log(message:string) {\r\n        const div = document.createElement(\"div\");\r\n        div.innerText = message;\r\n        document.getElementsByTagName(\"main\")[0].append(div);\r\n    }\r\n    \r\n\r\n    channel_init(channel:RTCDataChannel) {\r\n        this.channel = channel;\r\n\r\n        // debug\r\n        const btnSend = <HTMLButtonElement> document.getElementById(\"btnSend\");\r\n\r\n        channel.onopen = channel.onclose =  function handleSendChannelStatusChange(event) {\r\n            console.log(\"channel status change: \", event);\r\n            if (channel) {\r\n                console.log(\"channel status: \", channel.readyState);\r\n                btnSend.disabled = channel.readyState != \"open\"\r\n            }\r\n            else btnSend.disabled = true;\r\n        };\r\n\r\n        channel.onmessage = (e) => {\r\n            console.log(\"handleReceiveMessage: \", e);    \r\n            this.log(e.data);\r\n        };\r\n\r\n        \r\n    }\r\n\r\n    /** resolves once null candidate is found (which apparently signifies end of candidate list) */\r\n    async getCandidates() {\r\n        // TODO: i foresee issues with \"ice trickling here\"\r\n        \r\n        let candidate_count = 0;\r\n        return new Promise((resolve, reject) => {\r\n\r\n            this.local.onicecandidate = async (event:RTCPeerConnectionIceEvent) => {\r\n                //console.log(\"CANDIDATE: \", event); \r\n            \r\n                if (event.candidate) {\r\n                    try { \r\n                        await this.local.addIceCandidate(event.candidate);\r\n                        candidate_count++;\r\n\r\n                    } \r\n                    catch (error) {\r\n                        console.error(\"failed to add candidate: \", { event, error });\r\n                        reject(error);\r\n                    }\r\n                }\r\n                else {\r\n                    resolve(candidate_count);\r\n                }\r\n            \r\n            }\r\n            \r\n\r\n        })\r\n    }\r\n\r\n\r\n\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { Client } from \"./peer/client\";\r\nimport { Host } from \"./peer/host\";\r\nimport { Peer } from \"./peer/peer.js\";\r\n\r\nexport {};\r\n\r\n\r\n// ISSUE: need TURN for certains situations (like VPNs or symmetric NATs or w/e)\r\n//          but these free public turn servers are disconnecting and lagging like crazy.\r\n//          not sure if it's because TCP is slower or just the servers are bad\r\n\r\nconst local = new RTCPeerConnection({\r\n    iceServers: [\r\n        { urls: 'stun:stun.l.google.com:19302' },\r\n    ]\r\n});\r\n\r\n\r\n\r\n\r\n\r\nlet peer:Peer;\r\n\r\n// #region hosting...\r\nconst btnHost = <HTMLButtonElement>document.getElementById(\"btnHost\");\r\nbtnHost.onclick = async function() {\r\n    btnHost.disabled = btnJoin.disabled = true;\r\n    peer = new Host(local);\r\n    await peer.init();\r\n}\r\n// #endreigon\r\n\r\n\r\n\r\n// #region joining...\r\nconst btnJoin = <HTMLButtonElement>document.getElementById(\"btnJoin\");\r\nbtnJoin.onclick = async function() {\r\n    btnJoin.disabled = btnHost.disabled = true;\r\n    peer = new Client(local);\r\n    await peer.init();\r\n}\r\n// #endregion\r\n\r\n\r\nconst btnSend = <HTMLButtonElement>document.getElementById(\"btnSend\");\r\nbtnSend.onclick = function() {\r\n    peer.send(\"data from send button!\");\r\n}\r\n"],"names":[],"sourceRoot":""}